---
title: "User Guide **SARtisanal** package to calculate of Swept Area Ratio (SAR) in artisanal fisheries context"
subtitle: "Proyecto IN-BENTO (Desarrollo de bioindicadores para el seguimiento de los ecosistemas intermareal y submareal sometidos a explotación marisquera en el litoral de Huelva) (Consejería de Universidad, Investigación e Innovación de la Junta de Andalucía y el Gobierno de España. Financiado por la Unión Europea-NextGeneration EU. MRR)"
author: "Mardones. M., Delgado, M.,..."
date:  "`r format(Sys.time(), '%d %B, %Y')`"
#bibliography: INBENTO.bib
#csl: apa.csl
link-citations: yes
linkcolor: blue
output:
  html_document:
    keep_md: true
    toc: true
    toc_float:
      collapsed: false
      smooth_scroll: false
    theme: cosmo
    fontsize: 0.9em
    linestretch: 1.7
    html-math-method: katex
    self-contained: true
    code-tools: true
# title: "![](IEO-logo2.png){width=10cm}"
# output:
#   bookdown::pdf_document2:
#     includes:
#       before_body: titulo.sty
#     keep_tex: yes
#     number_sections: no
#     toc: true
#     toc_depth: 3
# bibliography: INBENTO.bib
# csl: apa.csl
# link-citations: yes
# linkcolor: blue
# indent: no
# header-includes:
# - \usepackage{fancyhdr}
# - \pagestyle{fancy}
# - \fancyhf{}
# - \lfoot[\thepage]{}
# - \rfoot[]{\thepage}
# - \fontsize{12}{22}
# - \selectfont
---

\newpage

```{r setup1, echo =FALSE}
rm(list = ls())
knitr::opts_chunk$set(message = FALSE,
                      eval = TRUE,
                      warning = FALSE,
                      echo=TRUE,
                      fig.align = 'center',
                      dev = 'jpeg',
                      dpi = 300, 
                      fig.align='center')
#XQuartz is a mess, put this in your onload to default to cairo instead
options(bitmapType = "cairo") 
# (https://github.com/tidyverse/ggplot2/issues/2655)
# Lo mapas se hacen mas rapido
```



# Initial steps

Load `SARtisanal` library from github pages using `devtools`

```{r eval=FALSE}
library(devtools)
install_github("MauroMardones/SARtisanal")
```


```{r}
library(SARtisanal)
```

and load another important packages;

```{r libs, message=FALSE}
library(tidyverse)
library(ggridges)
library(here)
library(lubridate)
library(readr)
library(ggthemes)
library(kableExtra)
library(gtsummary)
library(egg)
library(ggthemes)
library(sf)
```
Example to load own data;

```{r read}
archivos <- c("Draga_01.txt", 
              "Draga_02.txt", 
              "Draga_03.txt")
carpeta <- "your/path"

# Read and join all files
if (all(file.exists(file.path(carpeta, archivos)))) {
  datos_combinados <- read_artdata(archivos, carpeta, sep = ",")
  print(datos_combinados)
} else {
  warning("One or more files are not found in the specified folder.")
}
```

Calculating distances;

1. Load data example

```{r}
data("artdata")
```


2. Remove duplicate data with `remo_dup`;

```{r}
head(artdata)
artdata2 <- remo_dup(artdata)
dim(artdata2)
```

3. Call the `distar` function using `mapply`;

```{r}
# Calcular distancias entre filas consecutivas
distancia <- mapply(distart,
   artdata2$N_LATITUD,
   artdata2$N_LONGITUD,
   lag(artdata2$N_LATITUD),
   lag(artdata2$N_LONGITUD)
   ) 
  
artdata2 <- artdata2 %>%
  mutate(distancia = distancia) %>% 
  mutate_if(is.numeric, round, 3)
```


Visualizing data with `skim`;

```{r}
skimr::skim(artdata2)
```

# Calculate SAR

First Swept Area using `SAbarrida`;

```{r eval=FALSE}
artdataSA <- artdata2 %>% 
  mutate(
    SA = SAbarrida(distancia, ancho = 2.5),  # Cálculo del SA con ancho 2.5 metros
    SA2 = SAbarrida(distancia, ancho = 3)  # Cálculo del SA con otro ancho
  )
```
```{r}
# Filtrar solo las columnas numéricas y eliminar NAs
numeric_data <- artdataSA %>%
  select_if(is.numeric) %>%
  select_if(~ var(.) != 0) %>%  # Excluir columnas con varianza cero
  na.omit()  # Eliminar filas con NAs

# Seleccionar solo las columnas específicas y eliminar filas con NAs
selected_data <- artdataSA %>%
  select(N_LATITUD, N_LONGITUD, N_VELOCIDAD, N_SATELITES , N_SATELITES , distancia, SA, SA2) %>%
  na.omit()  # Eliminar filas con NAs

# Calcular la matriz de correlación
cor_matrix <- cor(selected_data)

# Crear el heatmap de la matriz de correlación
library(pheatmap)
pheatmap(cor_matrix, 
         display_numbers = TRUE, 
         number_format = "%.2f", 
         main = "Correlation Heatmap")


```

```{r}
library(dplyr)
library(ggplot2)
library(cluster)

# Filtrar datos donde la distancia sea menor a 5000 metros y seleccionar columnas específicas
filtered_data <- artdataSA %>%
  filter(distancia < 5000) %>%
  select(N_LATITUD, N_LONGITUD, N_VELOCIDAD, N_SATELITES, distancia, SA, SA2) %>%
  na.omit()  # Eliminar filas con NAs

# Escalar los datos para normalizar las unidades de las variables
scaled_data <- scale(filtered_data)

# Calcular la matriz de distancias
dist_matrix <- dist(scaled_data)

# Realizar el clustering jerárquico usando el método de enlace completo
hclust_model <- hclust(dist_matrix, method = "complete")

# Crear el dendrograma
plot(hclust_model, 
     main = "Dendrograma de Clustering Jerárquico", 
     xlab = "Observaciones", 
     ylab = "Distancia")

# Crear clusters en base al dendrograma, eligiendo el número de clusters deseado
num_clusters <- 4  # Ajusta este número según tus necesidades
cluster_groups <- cutree(hclust_model, k = num_clusters)

# Agregar los resultados de clustering al conjunto de datos original
filtered_data <- filtered_data %>%
  mutate(cluster = factor(cluster_groups))

# Visualización de las primeras dos dimensiones con los clusters
ggplot(filtered_data, aes(y = N_LATITUD, x = SA)) +
  geom_point(size = 2) +
  labs(title = "Clustering Jerárquico en Datos de Distancia Menor a 5000m",
       x = "Latitud",
       y = "Longitud") +
  theme_minimal()

```



# Maps

# References
